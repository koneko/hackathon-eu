<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Students & Teachers Achieving Results</title>
		<link rel="stylesheet" href="/css/navbar.css" />
		<link rel="stylesheet" href="/css/general.css" />
		<script
			src="https://kit.fontawesome.com/11fc85fa63.js"
			crossorigin="anonymous"
		></script>
		<link
			rel="icon"
			href="https://hub.koneko.link/cdn/icons/blue.png"
			type="image/gif"
			sizes="16x16"
		/>
		<meta property="og:title" content="Fill later." />
		<meta name="description" content="Fill later." />
		<meta property="og:description" content="Fill later." />
		<meta property="og:site_name" content="Fill later." />
		<meta name="twitter:card" content="Fill later." />
		<meta property="twitter:title" content="Fill later." />
		<style>
			#myUL {
				width: 900px;
				list-style-type: none;
				/* padding: 0; */
				margin: auto;
				text-align: center;
				display: flex;
				flex-direction: row;
				gap: 10px;
				margin-top: 10px;
			}
			#myUL > li {
				/* like a badge */
				background-color: rgb(59, 179, 235);
				color: white;
				width: 150px;
				height: 50px;
				padding: 10px;
				border-radius: 10px;
				font-size: 14px;
				cursor: pointer;
			}
			#myUL > li > a {
				color: white;
			}
		</style>
	</head>
	<body>
		<ul class="navbar">
			<li>
				<a href="/" style="font-weight: bold"
					>Students & Teachers Achieving Results</a
				>
			</li>
			<li><a href="/discover">Discover</a></li>
			<li style="float: right">
				<a href="/account" id="account-label">Account</a>
			</li>
		</ul>
		<main id="main">
			<p>
				Please login via your email. If you do not already have an
				account, one will be created for you.
			</p>

			<input
				type="text"
				placeholder="johndoe@gmail.com"
				id="email"
				class="input"
			/>
			<button class="btn" onclick="submit()">Sign In</button>
		</main>
		<script>
			let tags = [];
			let email = "";
			function filterTags() {
				// Declare variables
				var input, filter, ul, li, a, i, txtValue;
				input = document.getElementById("myInput");
				filter = input.value.toUpperCase();
				ul = document.getElementById("myUL");
				li = ul.getElementsByTagName("li");

				// Loop through all list items, and hide those who don't match the search query
				for (i = 0; i < li.length; i++) {
					a = li[i].getElementsByTagName("a")[0];
					txtValue = a.textContent || a.innerText;
					if (txtValue.toUpperCase().indexOf(filter) > -1) {
						li[i].style.display = "";
					} else {
						li[i].style.display = "none";
					}
				}
			}
			function login() {
				const codeArray = [
					document.getElementById("1").value,
					document.getElementById("2").value,
					document.getElementById("3").value,
					document.getElementById("4").value,
					document.getElementById("5").value,
					document.getElementById("6").value,
				];
				const code = codeArray.join("");
				fetch("/api/verify/mailcode", {
					method: "POST",
					body: JSON.stringify({
						user_id: localStorage.getItem("STAR_user_id"),
						mail_code: code,
					}),
				})
					.then((res) => res.json())
					.then((res) => {
						localStorage.setItem("STAR_session_id", res.session_id);
					});
			}
			function tag(tag) {
				if (tags.includes(tag)) {
					tags = tags.filter((t) => t !== tag);
					this.style.backgroundColor = "rgb(59, 179, 235)";
				} else {
					if (tags.length < 10) {
						tags.push(tag);
						this.style.backgroundColor = "pink";
					} else {
						alert("You can only select up to 10 tags.");
					}
				}
			}
			function createAccount() {
				let name = document.getElementById("name");
				let lastname = document.getElementById("surname");
				let accType = document.getElementById("acctype").value;
				if (accType == 0) {
					accType = "Student";
				} else {
					accType = "Teacher";
				}
				apiCreateAccount(name, lastname, email, accType, tags);
			}
			function apiCreateAccount(name, lastName, mail, accType, tags) {}
			function submit() {
				email = document.getElementById("email").value;
				const emailRegex =
					/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
				if (emailRegex.test(email)) {
					fetch("/api/getAcc", {
						method: "POST",
						body: `{"mail":"${email}"}`,
					})
						.then((res) => res.json())
						.then(async (res) => {
							// account exists
							let userid = res.user_id;
							localStorage.setItem("STAR_user_id", userid);
							document.getElementById("main").innerHTML = `
								<p>A verification code has been sent to your mail, please input the 6 digits you have recieved into the boxes below.</p>
								<input id="1"/>
								<input id="2"/>
								<input id="3"/>
								<input id="4"/>
								<input id="5"/>
								<input id="6"/><br>
								<button class="btn" onclick="login()">Send</button>
								`;
						})
						.catch(() => {
							// account doesnt exist
							document.getElementById("main").innerHTML = `
							<p>Tell us some more information about you.</p>
							<input id="name" placeholder="Name" />
							<input id="surname" placeholder="Surname" />
							<p>Are you a student or a teacher?</p>
							<select id="acctype"><option value="0">Student</option> <option value="1">Teacher</option> </select>
							<p>Choose atleast one and up to 10 tags to learn/teach.</p>
							<input type="text" id="myInput" onkeyup="filterTags()" placeholder="Search for tags...">
								<br>
							<ul id="myUL">
							<li onclick="tag('Chemistry')"><a>Chemistry</a></li>
							<li onclick="tag('Biology')"><a>Biology</a></li>

							<li onclick="tag('C#')"><a>C#</a></li>
							<li onclick="tag('C')"><a>C</a></li>

							<li onclick="tag('C++')"><a>C++</a></li>
							<li onclick="tag('Javascript')"><a>Javascript</a></li>
							<li onclick="tag('Web Development')"><a>Web Development</a></li>
							</ul>
							<button onclick='createAccount()'>Finish</button>
							`;
						});
				} else {
					alert("Please input a valid email address.");
				}
			}
		</script>
	</body>
</html>
